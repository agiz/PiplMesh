{% load i18n %}<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>{% block fulltitle %}{% block title %}{% endblock %} â€“ wlan slovenija{% endblock %}</title>
		<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
        <link type="image/x-icon" href="{{ STATIC_URL }}piplmesh/images/favicon.ico" rel="shortcut icon" />
        <link type="image/x-icon" href="{{ STATIC_URL }}piplmesh/images/favicon.ico" rel="icon" />
        <link rel="stylesheet" href="{{ STATIC_URL }}piplmesh/css/style.css" type="text/css" media="screen" />
        <link rel="stylesheet" href="https://www.google.com/cse/style/look/default.css" type="text/css" />
        <script src="{{ STATIC_URL }}piplmesh/js/jQuery_library_1_7_1.js" type="text/javascript"></script>

{% load pushserver %}

<script type="text/javascript">
    var updates_url = '{% filter escapejs %}{% updates_url "a" %}{% endfilter %}';


$(document).ajaxSend(function(event, xhr, settings) {
    function getCookie(name) {
        var cookieValue = null;
        if (document.cookie && document.cookie != '') {
            var cookies = document.cookie.split(';');
            for (var i = 0; i < cookies.length; i++) {
                var cookie = jQuery.trim(cookies[i]);
                // Does this cookie string begin with the name we want?
                if (cookie.substring(0, name.length + 1) == (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
    function sameOrigin(url) {
        // url could be relative or scheme relative or absolute
        var host = document.location.host; // host + port
        var protocol = document.location.protocol;
        var sr_origin = '//' + host;
        var origin = protocol + sr_origin;
        // Allow absolute or scheme relative URLs to same origin
        return (url == origin || url.slice(0, origin.length + 1) == origin + '/') ||
            (url == sr_origin || url.slice(0, sr_origin.length + 1) == sr_origin + '/') ||
            // or any other URL that isn't scheme relative or absolute i.e relative.
            !(/^(\/\/|http:|https:).*/.test(url));
    }
    function safeMethod(method) {
        return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
    }

    if (!safeMethod(settings.type) && sameOrigin(settings.url)) {
        xhr.setRequestHeader("X-CSRFToken", getCookie('csrftoken'));
    }
});


function authenticate(a, b) {
  $.ajax
    ({
        type: "POST",
        //the url where you want to sent the userName and password to
        url: '/send',
        dataType: 'json',
        async: false,
        //json object to sent to the authentication url
//        data: {'data':'{"type": "' + a + '", "value" : "' + b + '"}'},
        data: {'data':'{"type": "' + 'answer' + '", "value" : "' + b + '"}'},
//        data: {"data":"{'type': '" + a + "', 'value' : '" + b + "'}"},
//        data: {"data":"{'type': '" + 'answer' + "', 'value' : '" + b + "'}"},
        success: function () {
        console.log("success!"); 
        }
    })
}

</script>

<script type="text/javascript" src="{{ STATIC_URL }}pushserver/updates.js"></script>
<!--
<script type="text/javascript">
    var updates_url = '{% filter escapejs %}{% updates_url "b" %}{% endfilter %}';
</script>
<script type="text/javascript" src="{{ STATIC_URL }}pushserver/updates.js"></script>
-->
<script>
function updateAnswer(data) {
    // data.value == 42
    console.log('data');
    console.log(data);
}

registerUpdatesProcessor('answer', updateAnswer);
</script>

        {% block extrahead %}{% endblock %}
        {% block js %}{% endblock %}
        {% block css %}{% endblock %}
    </head>
    <body>
        {% block body %}{% endblock %}
    </body>
</html>
