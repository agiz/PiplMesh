<div>
    <ul id="map">
        <div id="content" class="nodemap">
            <div class="gmap_wrapper">
                <div id="gmap"></div>
            </div>
        </div>
    </ul>
</div>

<script src="{{ STATIC_URL }}piplmesh/js/nodes.js" type="text/javascript"></script>
<script src="{{ STATIC_URL }}piplmesh/js/gmap.js" type="text/javascript"></script>
<script type="text/javascript">
/* <![CDATA[ */
    var nodeMarker;
    var clickEnabled;

    function putMarker(map, point) {
        if (!nodeMarker) {
            nodeMarker = new google.maps.Marker(
                point,
                {
                    'icon': createIcon('new'),
                    'clickable': false,
                    'draggable': true
                }
            );
            google.maps.Event.addListener(nodeMarker, "dragend", function(point) {
                $('#id_geo_lat').val(point.lat());
                $('#id_geo_long').val(point.lng());
            });
            map.addOverlay(nodeMarker);
        }
        else {
            nodeMarker.setLatLng(point);
        }
        
        $('#id_geo_lat').val(point.lat());
        $('#id_geo_long').val(point.lng());
    }

    function createMap() {
        if (google.maps.BrowserIsCompatible()) {
            var map = new google.maps.Map2(document.getElementById("gmap"));
            map.setCenter(new google.maps.LatLng(46.17, 14.96), 8);
            map.removeMapType(map.getMapTypes()[1]);
            map.enableDoubleClickZoom();
            map.addControl(new google.maps.SmallMapControl());
            map.addControl(new google.maps.MapTypeControl());
            map.addControl(new google.maps.ScaleControl());

            if (typeof mapInit == "function") {
                mapInit(map);
            }
        }
    }

    $(document).ready(function() { createMap(); });
/* ]]> */
</script>
<script type="text/javascript" src="{{ STATIC_URL }}piplmesh/js/map.js"></script>